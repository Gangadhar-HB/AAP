---
# check_vm_present.yml
- name: Check if VM {{ item.name }} is already present in {{ item.hostip }}
  shell: "sudo virsh list --all | tail -n +3 | awk '{print $2}'"
  register: vm_present
  ignore_errors: true

- block:
    - name: VM's already present in Baremetel
      set_fact:
        already_present: "{{ already_present | default([]) + [item.name] }}"
  when: item.name in vm_present.stdout
